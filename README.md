# ğŸ‘® LAPD: Large language model Alignment through Persona Dynamics

## AIKU 24-Spring Project

**Authors**: ë°•ì„œí˜„(íŒ€ì¥), ì„±ì¤€ì˜, ì´ì¢…í›ˆ, í™©ì •í˜„

AIKU 2024ë…„ ì „ë°˜ê¸° í”„ë¡œì íŠ¸ / ê³ ë ¤ëŒ€í•™êµ CS471n ìì—°ì–´ì²˜ë¦¬ 4íŒ€

## í”„ë¡œì íŠ¸ ê°œìš”
ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” LLMì´ íŠ¹ì • í˜ë¥´ì†Œë‚˜(MBTI)ë¡œ íŒŒì¸ íŠœë‹ë˜ì—ˆì„ ë•Œì˜ ëª¨ë¸ì˜ í–‰ë™ ë° ì„ í˜¸ì˜ ì–‘ìƒì„ ê´€ì°°í•˜ì˜€ìŠµë‹ˆë‹¤. ëª¨ë¸ì€ LLaMA-3 Instruct 8Bë¥¼, DPOë¥¼ ì‚¬ìš©í•˜ì—¬ í•™ìŠµë˜ì—ˆìœ¼ë©°, í•™ìŠµ ë°ì´í„°ëŠ” ê° MBTI ë³„ íŠ¹ì§•ì„ ë°˜ì˜í•˜ë„ë¡ GPT-4ë¥¼ í™œìš©í•˜ì—¬ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. 
í•™ìŠµ í›„ ëª¨ë¸ë“¤ì„ AI Alignment Benchmarkë“¤ì„ í†µí•´ ëª¨ë¸ì˜ ë³€í™”ë¥¼ ì •ëŸ‰, ì •ì„±ì ìœ¼ë¡œ í‰ê°€í•˜ì˜€ìŠµë‹ˆë‹¤. 
ê° ëª¨ë¸ë³„ë¡œ MBTIì˜ ì„±í–¥ì´ ë°œí˜„ëœ ê²°ê³¼ë“¤ì„ í¬ì°©í•˜ì˜€ìŠµë‹ˆë‹¤. íŠ¹íˆ, ìƒˆë¡œ í•™ìŠµí•œ MBTI íŠ¹ì§•ë“¤ì´ ë°œí˜„ë˜ì–´ ì•½ë¬¼, ë²”ì£„ ë“±ê³¼ ê´€ë ¨ëœ ë¹„ìœ¤ë¦¬ì  ì§ˆì˜ì— íš¨ê³¼ì ìœ¼ë¡œ ëŒ€ì‘í•˜ê³ , ì‹œë ¨ì— ì²˜í•œ ì‚¬ëŒì˜ ìƒí™©ì— ë” ê¹Šê²Œ ê³µê°í•˜ëŠ” ë“± í–¥ìƒëœ ë„ë•ì„± ë° ì‚¬íšŒì„±ì˜ ê°€ëŠ¥ì„±ì„ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤. 
í•™ìŠµì— í™œìš©ëœ ë°ì´í„°ì…‹ì€ ë³¸ ë ˆí¬ì§€í† ë¦¬ì˜ data í´ë”ì— ìœ„ì¹˜í•˜ë©°, ì•„ë˜ì˜ ê³¼ì •ì„ í†µí•´ ìƒì„±í•œ ë°ì´í„°ë¡œ ëª¨ë¸ì„ í•™ìŠµì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ë” ë§ì€ ì •ë³´ë¥¼ ì–»ê³ ì‹¶ìœ¼ì‹œë‹¤ë©´, [AIKU ë…¸ì…˜](https://www.notion.so/aiku/Mamihlapinatap-ai-d0100f9c85424342bd47a2c496ebe25e)ì— ë°©ë¬¸í•˜ì…”ì„œ í™•ì¸í•´ ì£¼ì„¸ìš”!

## í™˜ê²½ êµ¬ì¶•

* Python 3.10+
* Linux
* NVIDIA GPU + CUDA CuDNN
* CUDAToolKit >= 11.8
* Pytorch >= 2.2
* Unsloth ê°€ìƒí™˜ê²½

Anacondaë¥¼ ì‚¬ìš©í•˜ì—¬ ë³¸ ë ˆí¬ì§€í† ë¦¬ë¥¼ ì‚¬ìš©í•˜ê¸°ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤. 

í™˜ê²½ êµ¬ì¶• ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. **Unsloth ê°€ìƒí™˜ê²½ ì„¤ì¹˜**:

CUDA ë²„ì „ì— ë§ì¶”ì–´ pytorch-cuda ë²„ì „ì„ ì„¤ì •í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.
CUDA 12.1ì„ ì‚¬ìš©í•˜ì‹¤ ê²½ìš°ì—”, pytorch-cuda=12.1ë¡œ ì§€ì •í•˜ë©´ ë©ë‹ˆë‹¤. 
```
conda create --name unsloth_env \
    python=3.10 \
    pytorch-cuda=<your_CUDA_version> \
    pytorch cudatoolkit xformers -c pytorch -c nvidia -c xformers \
    -y
conda activate unsloth_env

pip install "unsloth[colab-new] @ git+https://github.com/unslothai/unsloth.git"

pip install --no-deps "trl<0.9.0" peft accelerate bitsandbytes

```

2. **ë ˆí¬ì§€í† ë¦¬ ë³µì œ ë° ê°€ìƒí™˜ê²½ í™œì„±í™”**:
   ë³¸ ë ˆí¬ì§€í† ë¦¬ë¥¼ ë³µì œí•˜ê³ , 1ì—ì„œ êµ¬ì¶•í•œ unsloth_env ê°€ìƒí™˜ê²½ì„ í™œì„±í™”ì‹œì¼œì£¼ì‹œë©´ ë©ë‹ˆë‹¤.
   ```
  conda activate unsloth_env
  git clone https://github.com/joonyeongs/PersonaAgent.git
  cd PersonAgent  
  ``'

## ëª¨ë¸ í›ˆë ¨
ëª¨ë¸ì€ script í´ë” ë‚´ë¶€ì— ìˆëŠ” .sh íŒŒì¼ì„ ë¡œì»¬ í™˜ê²½ì— ë§ì¶”ì–´ ìˆ˜ì •í•˜ê³ , shellì— ë‹¤ìŒ ëª…ë ¹ì„ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤
'''
bash scripts/train_single_model.sh
'''

ìŠ¤í¬ë¦½íŠ¸ì˜ argumentë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
'''
--dataset_dir í•™ìŠµ ë°ì´í„°ì…‹ ê²½ë¡œ \
--beta DPO ìµœì í™”í•¨ìˆ˜ ë² íƒ€ ê°’  \
--output_dir ëª¨ë¸ ì €ì¥ê²½ë¡œ \
--epoch ì—í¬í¬ ìˆ˜ \
--mbti í•™ìŠµí•˜ê¸°ë¥¼ ì›í•˜ëŠ” MBTI(ì €ì¥ ê²½ë¡œìš©) \
'''

ë˜ëŠ” í„°ë¯¸ë„ì—ì„œ ì§ì ‘ ì‹¤í–‰ì‹œí‚¤ì…”ë„ ë©ë‹ˆë‹¤.

'''
python trainer.py
--dataset_dir í•™ìŠµ ë°ì´í„°ì…‹ ê²½ë¡œ \
--beta DPO ìµœì í™”í•¨ìˆ˜ ë² íƒ€ ê°’  \
--output_dir ëª¨ë¸ ì €ì¥ê²½ë¡œ \
--epoch ì—í¬í¬ ìˆ˜ \
--mbti í•™ìŠµí•˜ê¸°ë¥¼ ì›í•˜ëŠ” MBTI(ì €ì¥ ê²½ë¡œìš©) \
'''


 
